# Starts counting at 1 because 0 is annoying
set -g base-index 1

# Bind prefix-r to reload tmux config
bind r source-file ~/.config/tmux/tmux.conf

# No delay for escape key press
set -sg escape-time 0

# Change prefix from C-b to C-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Not quite sure what this does, but it's good apparently
setw -g aggressive-resize on

# Set prefix highlight prompt
set -g @prefix_highlight_prefix_prompt 'Prefix'

# Fix colour settings for vim + alacritty + tmux
# https://gist.github.com/andersevenrud/015e61af2fd264371032763d4ed965b6#tmux
# "tmux-256color" doesn't work for me on macOS, but this does
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Mouse mode
set -g mouse on

# Enable vi mode
set-window-option -g mode-keys vi

# Colours
# Add prefix highlight to status bar
set -g status-right '#{prefix_highlight} | %a %Y-%m-%d %H:%M'
# Pane divider colours
set -g pane-active-border-style "fg=#80a0ff bg=#080808"
# Status bar colours
set -g status-style "fg=#080808 bg=#80a0ff"

# To make tmux.nvim work https://github.com/aserowy/tmux.nvim#navigation
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -LZ' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -DZ' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -UZ' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -RZ' }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -LZ'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -DZ'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -UZ'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -RZ'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# Install TMUX plugins outside of the config folder
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.local/share/tmux/plugins'

bind C-l send-keys 'C-l'

# Balance panes
bind M-1 select-layout even-vertical
bind M-2 select-layout even-horizontal

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.local/share/tmux/plugins/tpm/tpm'
